# :gear: 技术文档

> 更新日期：2021/07/22
>
>版本号：v0.1.1

核心技术栈：`Python3`||`Selenium`

## 1 环境复现

> [注意] 本文档将以如下参考配置进行项目说明

- 开发工具：`Pycharm Community 2021.1` 、`Anaconda（env Python3.7）`

- 操作系统：`Windows 10.0.19041`

- 必要组件：`google-chrome v91.0.4472.124` 、`chromedriver_win32 v92.0.4472.101`

## 2 启动项目

定义如下变量用于流程演示

> - `gt3`：一类需要点击激活验证界面的版本；
> - `gt2`：一类无需点击伴随有丰富卡通背景图的版本；
>
> - `full_img`：原始背景图；
> - `notch_img`：带有“拼图缺口”的背景图；

### 2.1 快速上手

在`Pycharm` 中运行终端`Terminal`，以目录`./armour-geetest`为运行根按序执行以下指令。

（1）拉取依赖

```python
# ./armour-geetest
pip install -r requirements.txt -i https://pypi.tuna.tsinghua.edu.cn/simple
```

（2）运行demo

```python
# ./armour-geetest
python main.py
```

（3）查看输出

通过观看[ArmourGeeTest滑动验证](https://www.yuque.com/docs/share/70b51b3c-b434-4e7f-b18a-62c806108488?#)demo演示了解本项目的工作范围，获取的`full_img`以及`notch_img`将分别根据`/src/config.py`中的路径`FULL_IMG_PATH`以及`NOTCH_IMG_PATH`存放到指定路径下，默认在`/src/databse/cache`文件夹中（项目初始化后自动生成）。

### 2.2 打开冰箱门

> 本项目采集器依赖`Selenium`实现对`Chrome浏览器`的操作，需要运行环境中存在`Chrome`以及`chromdriver.exe`。

#### 2.2.1 配置`google-chrome`开发环境

（1）安装Chrome

> 若您电脑中已存在Chrome浏览器请跳过此步骤

访问[Google Chrome](https://www.google.com/intl/zh-CN/chrome/)下载（最新版）Chrome应用程序。

（2）查看Chrome version

如下图所示，在搜索栏中输入`chrome://settings/help`查看软件版本。

<img src="https://i.loli.net/2021/07/20/mjGHvCa53ItULSl.png" alt="image-20210720020533007" style="zoom: 33%;" />

（3）安装chromedriver

访问[驱动镜像网页](https://npm.taobao.org/mirrors/chromedriver/)选择对应版本、对应操作系统的应用程序下载并解压出chromedriver。

版本的选择建议：前3组十进制版本号需要和Chrome的一致，再根据发布时间选择最新的小版本，如下图所示。

<img src="https://i.loli.net/2021/07/20/gU4qwGOxsF1lSec.png" alt="image-20210720021451671" style="zoom:33%;" />

#### 2.2.2 配置`config.py`项目启动参数

> 本项目配置文件中，必须合理配置`CHROMEDRIVER_PATH`参数才能启动采集器（Collector）

关于`CHROMEDRIVER_PATH`路径确定的源码如下：

```python
# ./armour-geetest/src/config.py

# 系统默认的chromedriver文件路径，既./armour-geetest/chromedriver.exe
CHROMEDRIVER_PATH = dirname(__file__) + "/chromedriver.exe"

# 若chromedriver不在CHROMEDRIVER_PATH指定的路径下 尝试从环境变量中查找路径
if not exists(CHROMEDRIVER_PATH):
    CHROMEDRIVER_PATH = None
```

其中，**建议开发者将下载好的文件移至`./armour-geetest`工程目录下**
，系统运行时既可自动读取chromedriver程序；否则需要经过一系列较为繁琐的环境变量配置过程，可参考[此文章](https://www.freesion.com/article/29381322626/)，此时`CHROMEDRIVER_PATH`将被置为`None`，系统运行时根据环境变量`PATH`读取chromedriver。

以上仅是推荐配置，若您对Python3开发足够熟练，可改动任意源码二次开发。

### 2.3 把大象装入冰箱

### 2.4 关闭冰箱门

## 3 其他设置

### 3.1 关于`Selenium`常见报错

> 关于`WebdriverException`异常类型的中文解释可参考[此文章](https://blog.csdn.net/To_ChaRiver/article/details/105715293)

### 3.2 注意事项

> 更多注意事项详见[注意事项](https://github.com/QIN2DIM/armour-geetest/blob/main/docs/subs/注意事项.md)